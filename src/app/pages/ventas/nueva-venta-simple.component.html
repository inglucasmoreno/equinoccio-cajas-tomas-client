<!-- Modal: Crear producto -->
<app-modal [showModal]="showModalProducto">
  <div>

      <div class="flex items-center justify-between bg-primary-800 rounded-t p-2">
          <h1 class=" text-white px-2 py-1 rounded-t md:text-lg"> Creando producto </h1>
          <svg (click)="showModalProducto = false" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="cursor-pointer feather feather-x text-white mr-2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
      </div>

      <div class="px-2 max-h-96 overflow-y-auto text-sm">

        <div class="md:flex md:items-center mt-4">
            <div class="md:w-1/2">
              <p class="font-semibold"> <span class="text-red-500"> * </span>  Código </p>
              <input (keyup.enter)="nuevoProducto()" [(ngModel)]="productoForm.codigo" class="py-2 mt-1 border-b-2 border-gray-300 tranform duration-500 focus:border-secondaryColor appearance-none outline-none w-full text-gray-800" placeholder="Ej. 24545" type="text">
            </div>
            <div class="md:w-1/2 md:ml-4 mt-4 md:mt-0">
                <div class="w-full">
                    <p class="font-semibold"> <span class="text-red-500"> * </span> Descripción </p>
                    <input (keyup.enter)="nuevoProducto()" [(ngModel)]="productoForm.descripcion" class="py-2 mt-1 border-b-2 border-gray-300 tranform duration-500 focus:border-secondaryColor appearance-none outline-none w-full text-gray-800" placeholder="Ej. Madera" type="text">
                </div>
            </div>
        </div>

        <div class="md:flex md:items-center mt-4">
          <div class="md:w-1/2">
            <p class="font-semibold"> <span class="text-red-500"> * </span> Unidad de medida </p>
            <select [(ngModel)]="productoForm.unidad_medida" class="py-2 mt-1 border-b-2 border-gray-300 tranform duration-500 focus:border-secondaryColor outline-none w-full text-gray-800">
              <option value=""> Seleccionar unidad </option>
              <option *ngFor="let unidad of unidades" [value]="unidad._id"> {{ unidad.descripcion }} </option>
            </select>
          </div>
          <div class="md:w-1/2 md:ml-4 mt-4 md:mt-0">
            <div class="w-full">
                <p class="font-semibold"> Cantidad </p>
                <input (keyup.enter)="nuevoProducto()" min="0" [(ngModel)]="productoForm.cantidad" class="py-2 mt-1 border-b-2 border-gray-300 tranform duration-500 focus:border-secondaryColor appearance-none outline-none w-full text-gray-800" placeholder="Ej. 100" type="number">
            </div>
          </div>
        </div>

        <div class="md:flex md:items-center mt-4">
            <div class="md:w-1/2">
                <p class="font-semibold"> <span class="text-red-500"> * </span> Alerta de stock mínimo </p>
                <select [(ngModel)]="productoForm.stock_minimo_alerta" class="py-2 mt-1 border-b-2 border-gray-300 tranform duration-500 focus:border-secondaryColor outline-none w-full text-gray-800">
                    <option value="false"> Sin alerta </option>
                    <option value="true"> Con alerta </option>
                </select>
            </div>
            <div class="md:w-1/2 md:ml-4 mt-4 md:mt-0">
              <div class="w-full">
                  <p class="font-semibold"> <span class="text-red-500"> * </span> Cantidad minima </p>
                  <div *ngIf="productoForm.stock_minimo_alerta === 'false'" class="py-2 mt-1 border border-gray-400 bg-gray-100 px-2 appearance-none outline-none w-full text-gray-800"> Sin alerta por stock minimo </div>
                  <input *ngIf="productoForm.stock_minimo_alerta === 'true'" (keyup.enter)="nuevoProducto()" min="0" [(ngModel)]="productoForm.cantidad_minima" class="py-2 mt-1 border-b-2 border-gray-300 tranform duration-500 focus:border-secondaryColor appearance-none outline-none w-full text-gray-800" placeholder="Ej. 5" type="number">
              </div>
            </div>
        </div>

        <div class="md:flex md:items-center mt-4">
          <div class="md:w-1/2">
            <p class="font-semibold"> <span class="text-red-500"> * </span> Familia </p>
            <select [(ngModel)]="productoForm.familia" class="py-2 mt-1 border-b-2 border-gray-300 tranform duration-500 focus:border-secondaryColor outline-none w-full text-gray-800">
                <option value=""> Seleccionar familia </option>
                <option *ngFor="let familia of familias" [value]="familia._id"> {{ familia.descripcion }} </option>
            </select>
          </div>
          <div class="md:w-1/2 md:ml-4 mt-4 md:mt-0">
            <p class="font-semibold"> Precio </p>
            <input (keyup.enter)="nuevoProducto()" min="0" [(ngModel)]="productoForm.precio" class="py-2 mt-1 border-b-2 border-gray-300 tranform duration-500 focus:border-secondaryColor appearance-none outline-none w-full text-gray-800" placeholder="Ej. 1800" type="number">
          </div>
        </div>

    </div>
    <div class="px-2 pb-2">
        <button (click)="nuevoProducto()" class="bg-green-700 focus:outline-none shadow text-white w-full border border-green-700 hover:bg-green-600 p-2 text-sm rounded mt-4"> Crear producto </button>
    </div>
  </div>
</app-modal>

<!-- Modal: Nuevo cliente -->
<app-modal [showModal]="showModalCliente">
  <div (keyup.enter)="nuevoCliente()">
    <div class="flex items-center justify-between bg-primary-800 rounded-t p-2">
      <h1 class=" text-white px-2 py-1 rounded-t md:text-lg"> Creando cliente </h1>
      <svg (click)="showModalCliente = false" width="20" height="20" viewBox="0 0 24 24" fill="none"
        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
        class="cursor-pointer feather feather-x text-white mr-2">
        <line x1="18" y1="6" x2="6" y2="18"></line>
        <line x1="6" y1="6" x2="18" y2="18"></line>
      </svg>
    </div>
    <div class="px-2 pt-2 max-h-96 overflow-y-auto text-sm">
      <div>
        <p class="font-semibold"> <span class="text-red-500"> * </span> Razón social </p>
        <input [(ngModel)]="clientesForm.descripcion"
          class="py-2 mt-1 border-b-2 border-gray-300 tranform duration-500 focus:border-secondaryColor appearance-none outline-none w-full text-gray-800"
          placeholder="Ej. Equinoccio Technology" type="text">
      </div>
      <div class="md:flex md:items-center mt-4">
        <div class="md:w-1/2">
          <p class="font-semibold"> <span class="text-red-500"> * </span> Tipo de identificación </p>
          <select [(ngModel)]="clientesForm.tipo_identificacion"
            class="py-2 mt-1 border-b-2 border-gray-300 tranform duration-500 focus:border-secondaryColor outline-none w-full text-gray-800">
            <option value="DNI"> DNI </option>
            <option value="CUIL"> CUIL </option>
            <option value="CUIT"> CUIT </option>
          </select>
        </div>
        <div class="md:w-1/2 md:ml-4 mt-4 md:mt-0">
          <p class="font-semibold"> <span class="text-red-500"> * </span> Identificación </p>
          <input [(ngModel)]="clientesForm.identificacion"
            class="py-2 mt-1 border-b-2 border-gray-300 tranform duration-500 focus:border-secondaryColor appearance-none outline-none w-full text-gray-800"
            placeholder="Ej. 34060398" type="text">
        </div>
      </div>
      <div class="md:flex md:items-center mt-4">
        <div class="md:w-1/2">
          <p class="font-semibold"> Teléfono </p>
          <input [(ngModel)]="clientesForm.telefono"
            class="py-2 mt-1 border-b-2 border-gray-300 tranform duration-500 focus:border-secondaryColor appearance-none outline-none w-full text-gray-800"
            placeholder="Ej. 2664869642" type="text">
        </div>
        <div class="md:w-1/2 md:ml-4 mt-4 md:mt-0">
          <p class="font-semibold"> Correo electrónico </p>
          <input [(ngModel)]="clientesForm.correo_electronico"
            class="py-2 mt-1 border-b-2 border-gray-300 tranform duration-500 focus:border-secondaryColor appearance-none outline-none w-full text-gray-800"
            placeholder="Ej. equinocciotech@gmail.com" type="text">
        </div>
      </div>
      <div class="md:flex md:items-center mt-4">
        <div class="md:w-1/2">
          <p class="font-semibold"> Dirección </p>
          <input [(ngModel)]="clientesForm.direccion"
            class="py-2 mt-1 border-b-2 border-gray-300 tranform duration-500 focus:border-secondaryColor appearance-none outline-none w-full text-gray-800"
            placeholder="Ej. Portugal 1030" type="text">
        </div>
        <div class="md:w-1/2 md:ml-4 mt-4 md:mt-0">
          <p class="font-semibold"> Condición frente al IVA </p>
          <select [(ngModel)]="clientesForm.condicion_iva"
            class="py-2 mt-1 border-b-2 border-gray-300 tranform duration-500 focus:border-secondaryColor outline-none w-full text-gray-800">
            <option value="Consumidor Final"> Consumidor Final </option>
            <option value="IVA Responsable Inscripto"> IVA Responsable Inscripto </option>
            <option value="IVA Responsable no Inscripto"> IVA Responsable no Inscripto </option>
            <option value="IVA no Responsable"> IVA no Responsable </option>
            <option value="IVA Sujeto Exento"> IVA Sujeto Exento </option>
            <option value="Responsable Monotributo"> Responsable Monotributo </option>
            <option value="Sujeto no Categorizado"> Sujeto no Categorizado </option>
            <option value="Proveedor del Exterior"> Proveedor del Exterior </option>
            <option value="Cliente del Exterior"> Cliente del Exterior </option>
            <option value="IVA Liberado"> IVA Liberado </option>
            <option value="IVA Responsable Inscripto – Agente de Percepción"> IVA Responsable Inscripto –
              Agente de Percepción </option>
            <option value="Pequeño Contribuyente Eventual"> Pequeño Contribuyente Eventual </option>
            <option value="Monotributista Social"> Monotributista Social </option>
            <option value="Pequeño Contribuyente Eventual Social"> Pequeño Contribuyente Eventual Social
            </option>
          </select>
        </div>
      </div>
      <div class="mt-4">

      </div>
    </div>
    <div class="px-2 mt-2 pb-2">
      <button (click)="nuevoCliente()"
        class="bg-green-700 focus:outline-none text-sm hover:bg-green-600 shadow text-white w-full border border-green-700 p-2 rounded">
        Crear cliente </button>
    </div>

  </div>
</app-modal>

<div class="w-11/12 md:w-1/2 gsap-contenido mx-auto mt-4">
  <div class="bg-primary-800 p-3 rounded-t text-white text-lg">
    <div class="flex items-center justify-between">
      <div class="flex items-center">
        <app-boton-regresar routerLink="/dashboard/ventas-propias" class="mr-2"></app-boton-regresar>
        <h1> Creando nueva venta </h1>
      </div>
      <button (click)="crearVenta()" title="Completar venta"
        class="p-2 bg-white border focus:outline-none border-gray-400 rounded text-primary-800 hover:text-green-700">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
          class="w-5 h-5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
        </svg>
      </button>
    </div>
  </div>
  <div class="p-2">
    <h2 class="p-2 border border-gray-400 mt-2 bg-gray-100 font-semibold w-full text-sm"> Datos de la venta </h2>
    <div class="md:flex md:items-center mt-5 md:justify-center text-sm">
      <div class="md:w-1/2">
        <p class="font-semibold"> <span class="text-red-500"> * </span> Fecha de venta </p>
        <input [(ngModel)]="fecha_venta" type="date"
          class="border w-full mt-2 rounde focus:outline-none border-gray-400 p-2">
      </div>
      <div class="md:w-1/2 md:ml-4 mt-4 md:mt-0">
        <p class="font-semibold"> <span class="text-red-500"> * </span> Cliente </p>
        <div class="flex items-center">
          <select [(ngModel)]="clienteSeleccionado"
            class="p-2 border border-gray-400 w-full rounded focus:outline-none mt-2">
            <option value=""> Seleccionar cliente </option>
            <option *ngFor="let cliente of clientes" [value]="cliente._id"> {{ cliente.descripcion }} </option>
          </select>
          <button (click)="abrirModalCliente()" title="Nuevo cliente"
            class="ml-2 mt-2 hover:text-secondaryColor focus:outline-none border border-gray-400 p-2 rounded">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
              stroke="currentColor" class="w-5 h-5">
              <path stroke-linecap="round" stroke-linejoin="round"
                d="M19 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zM4 19.235v-.11a6.375 6.375 0 0112.75 0v.109A12.318 12.318 0 0110.374 21c-2.331 0-4.512-.645-6.374-1.766z" />
            </svg>
          </button>
        </div>
      </div>
    </div>
    <div class="md:flex md:items-center mt-4 md:justify-center text-sm">
      <div class="md:w-1/2">
        <p class="font-semibold"> <span class="text-red-500"> * </span> Caja </p>
        <select [(ngModel)]="cajaSeleccionada"
          class="p-2 border border-gray-400 w-full rounded focus:outline-none mt-2">
          <option value=""> Seleccionar caja </option>
          <option
            [ngClass]="{'bg-green-100 font-semibold': this.authService.caja && this.authService.caja._id === caja._id}"
            *ngFor="let caja of cajas" [value]="caja._id"> {{ caja.descripcion }} </option>
        </select>
      </div>
      <div class="md:w-1/2 md:ml-4 mt-4 md:mt-0">
        <p class="font-semibold"> <span class="text-red-500"> * </span> Monto </p>
        <input [(ngModel)]="monto" type="number" placeholder="Ingresar monto"
          class="border w-full mt-2 rounde focus:outline-none border-gray-400 p-2">
      </div>
    </div>
    <div class="mt-4 text-sm">
      <p class="font-semibold"> Observaciones </p>
      <input [(ngModel)]="observacion" type="text" placeholder="Observaciones no obligatorias"
        class="border w-full mt-2 rounde focus:outline-none border-gray-400 p-2">
    </div>
    <h2 class="p-2 border border-gray-400 mt-4 bg-gray-100 font-semibold w-full text-sm"> Listado de productos </h2>

    <!-- Agregar producto -->
    <div class="text-sm mx-auto flex items-center justify-center">
      <select [(ngModel)]="productoSeleccionado"
        class="p-2 border w-full border-gray-400 focus:outline-none rounded md:w-1/2 mt-4">
        <option value=""> Seleccionar productor </option>
        <option *ngFor="let producto of productos" [value]="producto._id"> {{ producto.descripcion }} </option>
      </select>
      <button (click)="agregarProducto()" title="Agregar producto"
        class="p-2 border mt-3 ml-2 focus:outline-none border-gray-400 rounded hover:text-green-700">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
          class="w-5 h-5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
        </svg>
      </button>
      <button (click)="abrirModalProducto()" title="Crear producto"
        class="p-2 border mt-3 ml-2 focus:outline-none border-gray-400 rounded hover:text-secondaryColor">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M20.25 7.5l-.625 10.632a2.25 2.25 0 01-2.247 2.118H6.622a2.25 2.25 0 01-2.247-2.118L3.75 7.5m8.25 3v6.75m0 0l-3-3m3 3l3-3M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125z" />
        </svg>
      </button>
    </div>

    <!-- Listado de productos -->
    <div *ngIf="productosVenta.length > 0">
      <div class="border mt-4 flex md:w-1/2 mx-auto items-center justify-between border-gray-400 p-2"
        *ngFor="let producto of productosVenta">
        <p class="font-semibold">
          {{ producto.descripcion }}
        </p>
        <button (click)="eliminarProducto(producto)" class="hover:text-red-700 focus:outline-none">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
            stroke="currentColor" class="w-5 h-5">
            <path stroke-linecap="round" stroke-linejoin="round"
              d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
          </svg>
        </button>
      </div>
    </div>

    <div class="text-center p-4 border border-gray-300 mx-auto text-sm bg-gray-100 text-gray-700 w-full md:w-1/2 mt-5"
      *ngIf="productosVenta.length <= 0">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
        class="w-10 h-10 mx-auto">
        <path stroke-linecap="round" stroke-linejoin="round"
          d="M20.25 7.5l-.625 10.632a2.25 2.25 0 01-2.247 2.118H6.622a2.25 2.25 0 01-2.247-2.118L3.75 7.5m6 4.125l2.25 2.25m0 0l2.25 2.25M12 13.875l2.25-2.25M12 13.875l-2.25 2.25M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125z" />
      </svg>
      <p class="mt-2"> No hay productos en la venta </p>
    </div>

  </div>
</div>
